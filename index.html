<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>happy birthday, iqraaa‚Ä¶</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#f9f7f3;
    --muted:#6e6359;
    --accent:#b86f4a;
    --card:#fffdf8;
    --text:#1f1f1f;
    --glass: rgba(255,255,255,0.7);
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#fffaf2,#f3ebe1);font-family:Inter,system-ui,Arial;}
  .app{max-width:980px;margin:28px auto;padding:22px;border-radius:28px;background:var(--card);box-shadow:0 20px 40px rgba(0,0,0,0.06);overflow:hidden;min-height:80vh;position:relative;}
  /* basic layout */
  .screen{display:none;gap:20px;align-items:center;}
  .screen.active{display:flex;flex-direction:column;}
  header.top{width:100%;display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
  .badge{font-size:12px;color:var(--muted);letter-spacing:0.12em;padding:6px 12px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);background:var(--glass)}
  h1{font-family:"Playfair Display",serif;font-size:32px;margin:6px 0;line-height:1.05;color:var(--text)}
  h1 span{color:var(--accent);font-style:italic}
  p.lead{color:var(--muted);max-width:720px}

  /* Unlock screen */
  #unlockScreen{min-height:50vh;justify-content:center;text-align:center;position:relative;padding:30px}
  #unlockBtn{background:linear-gradient(90deg,var(--accent),#d68b5f);border:none;padding:14px 28px;border-radius:999px;color:white;font-weight:600;font-size:16px;cursor:pointer;box-shadow:0 10px 30px rgba(184,111,74,0.18);}
  #canvasFire{position:absolute;inset:0;pointer-events:none;z-index:1}
  .small-note{color:var(--muted);margin-top:14px}

  /* Hero / greeting */
  .hero{display:flex;gap:28px;width:100%;align-items:center;flex-wrap:wrap}
  .hero-left{flex:1;min-width:260px}
  .hero-right{width:320px;border-radius:20px;overflow:hidden;background:#fff;box-shadow:0 12px 28px rgba(0,0,0,0.06)}
  .hero-right img{width:100%;height:100%;object-fit:cover;display:block}

  /* cake screen */
  .cake-wrap{display:flex;gap:28px;align-items:center;flex-wrap:wrap}
  .cake-card{flex:1;min-width:260px;display:flex;flex-direction:column;align-items:center;gap:14px}
  .cake-stage{position:relative;width:320px;height:320px;border-radius:16px;background:linear-gradient(180deg,#fffaf4,#f9f4ee);display:flex;align-items:center;justify-content:center;box-shadow:0 10px 30px rgba(0,0,0,0.05)}
  .cake-stage img{max-width:260px;width:260px;display:block}
  /* candle flame element */
  .flame{position:absolute;top:64px;width:26px;height:40px;transform-origin:center;pointer-events:auto}
  /* wish input (hidden initially) */
  .wish-box{display:none;flex-direction:column;gap:8px;align-items:center;margin-top:12px}
  .wish-input{width:100%;max-width:360px;height:46px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);padding:12px;font-size:15px;outline:none}
  .btn-soft{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:9px 18px;border-radius:999px;cursor:pointer}
  .btn-ghost{background:linear-gradient(90deg,var(--accent),#d68b5f);color:#fff;border:none;padding:10px 16px;border-radius:999px;cursor:pointer;font-weight:600}

  /* slider cut */
  .cut-area{width:100%;max-width:500px;margin-top:10px;display:flex;flex-direction:column;align-items:center;gap:8px}
  .slider-track{width:100%;height:48px;background:#eee;border-radius:999px;position:relative;overflow:hidden}
  .slider-knob{position:absolute;left:6px;top:6px;width:36px;height:36px;border-radius:50%;background:white;box-shadow:0 4px 12px rgba(0,0,0,0.12);display:flex;align-items:center;justify-content:center;cursor:grab}
  .slice{position:absolute;left:48%;top:38%;width:140px;transform-origin:left center;transition:transform 700ms cubic-bezier(.22,.9,.1,1)}
  .confetti{position:absolute;inset:0;pointer-events:none}

  /* polaroids */
  .polaroids{display:flex;gap:14px;flex-wrap:wrap;justify-content:center;margin-top:18px}
  .polaroid{width:160px;background:#fff;padding:10px;border-radius:8px;box-shadow:0 10px 20px rgba(0,0,0,0.06);transform-origin:center;transition:transform .28s}
  .polaroid img{width:100%;height:140px;object-fit:cover;border-radius:6px}
  .cap{font-size:13px;color:var(--muted);margin-top:8px;text-align:center}

  /* final / continue */
  .continue{margin-top:18px;display:flex;gap:10px;align-items:center}

  /* small responsive */
  @media (max-width:720px){
    .hero-right{width:100%;height:280px}
    .cake-stage{width:260px;height:260px}
  }

  /* tiny loading dots */
  .dots{display:inline-block}
  .dot{display:inline-block;width:6px;height:6px;background:#cfcfcf;border-radius:50%;margin:0 3px;opacity:0;animation:dots 1s infinite}
  .dot:nth-child(2){animation-delay:0.12s}
  .dot:nth-child(3){animation-delay:0.24s}
  @keyframes dots{50%{opacity:1}}
</style>
</head>
<body>
<div class="app" id="app">
  <header class="top">
    <div class="badge">for you, on your birthday</div>
    <div style="color:var(--muted);font-size:13px">15 ¬∑ 12 ¬∑ 2025</div>
  </header>

  <!-- 1) Unlock screen -->
  <section id="unlockScreen" class="screen active">
    <canvas id="canvasFire"></canvas>
    <div style="z-index:2">
      <h1>someone special has a surprise here</h1>
      <p class="lead" style="text-align:center;color:var(--muted)">Tap to unlock ‚Äî start the surprise.</p>
      <div style="height:18px"></div>
      <button id="unlockBtn">Tap to unlock</button>
      <div class="small-note">(Touch to start music & fireworks)</div>
    </div>
  </section>

  <!-- 2) Screen 2: greeting -->
  <section id="screen2" class="screen">
    <div class="hero">
      <div class="hero-left">
        <h1>happy birthday, <span>iqraaa‚Ä¶</span></h1>
        <p class="lead">I don‚Äôt say it often, but you‚Äôre the most precious part of my life ‚Äî the one person I‚Äôm genuinely scared to lose.<br><br>
        Thank you for standing with me in my lowest moments, for trying to understand me even when it wasn‚Äôt easy, and for choosing me through fights, ego, and chaos.<br><br>
        Hum kabhi perfect nahi rahe, hum hamesha ladte rahenge ‚Äî but despite everything, I‚Äôve never stopped choosing you. Not even for a second.</p>
      </div>
      <div class="hero-right">
        <!-- COLLAGE IMAGE: replace collage.jpg with your actual file -->
        <img id="collageImg" src="collage.jpg" alt="collage" />
      </div>
    </div>

    <div style="width:100%;display:flex;justify-content:center;margin-top:18px">
      <button class="btn-soft" id="toCake">Open the cake</button>
    </div>
  </section>

  <!-- 3) Cake + candle + wish -->
  <section id="cakeScreen" class="screen">
    <div class="cake-wrap">
      <div class="cake-card">
        <div class="cake-stage">
          <!-- cake image - replace cake-full.png with your asset -->
          <img id="cakeImg" src="cake-full.png" alt="cake" />
          <!-- flame element (we'll style/animate via JS/CSS) -->
          <svg id="flameSVG" class="flame" viewBox="0 0 40 60" style="display:block;">
            <defs><radialGradient id="g1"><stop offset="0" stop-color="#ffd48a"/><stop offset="1" stop-color="#ff6f3c"/></radialGradient></defs>
            <path d="M20 0 C14 18 28 22 20 60 C4 22 26 18 20 0 Z" fill="url(#g1)"></path>
          </svg>
        </div>

        <div class="wish-box" id="wishBox">
          <div style="font-size:14px;color:var(--muted)">make your wish here</div>
          <!-- blank input intentionally -->
          <textarea id="wishInput" class="wish-input" placeholder="" rows="2"></textarea>
          <div style="display:flex;gap:10px;align-items:center">
            <button id="okWish" class="btn-ghost">okay‚Ä¶</button>
          </div>
        </div>

        <div style="margin-top:8px;color:var(--muted);font-size:13px">Tap candle to blow or tap below</div>
        <div style="display:flex;gap:10px;margin-top:8px">
          <button id="tapBlow" class="btn-soft">Blow candle</button>
        </div>

      </div>

      <!-- right: instructions + slider cut -->
      <div style="flex:1;min-width:260px;display:flex;flex-direction:column;align-items:center">
        <div style="font-size:14px;color:var(--muted);text-align:center">Slide to cut the cake</div>

        <div class="cut-area">
          <div class="slider-track" id="sliderTrack">
            <div class="slider-knob" id="sliderKnob">‚ü∂</div>
          </div>
          <!-- slice image positioned over the cake: replace with cake-slice.png -->
          <img id="cakeSlice" class="slice" src="cake-slice.png" alt="slice" style="transform:translateX(0) rotate(0deg)"/>
          <div id="cutHint" style="font-size:13px;color:var(--muted)">Slide fully to remove a slice</div>
        </div>

        <div class="confetti" id="confetti"></div>

        <div style="margin-top:18px;display:flex;flex-direction:column;align-items:center">
          <div id="afterCutText" style="font-size:16px;color:var(--muted);display:none">Happy Birthday once again, budhuuu ‚ù§Ô∏èü´£</div>
          <div class="continue" style="display:none" id="continueWrap">
            <button class="btn-soft" id="toPolaroids">Continue</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 4) Polaroids -->
  <section id="polaroidScreen" class="screen">
    <h2 style="font-family:Playfair Display;margin-bottom:6px">memories</h2>
    <div class="polaroids">
      <!-- Replace images with your images; use filenames pol1.jpg, pol2.jpg etc -->
      <div class="polaroid"><img src="pol1.jpg"/><div class="cap">Teri nazron ne dil pe kiya hai asar‚Ä¶ ü•π‚ù§Ô∏è</div></div>
      <div class="polaroid"><img src="pol2.jpg"/><div class="cap">I‚Äôll always fall in love with that bholi si shakal</div></div>
      <div class="polaroid"><img src="pol3.jpg"/><div class="cap">Whenever I look into your eyes, everything else disappears</div></div>
      <div class="polaroid"><img src="pol4.jpg"/><div class="cap">Even in a crowd, my eyes only search for you</div></div>
    </div>

    <div style="margin-top:18px;display:flex;justify-content:center">
      <button class="btn-soft" id="toVideo">Open video</button>
    </div>
  </section>

  <!-- 5) Video placeholder / final -->
  <section id="videoScreen" class="screen" style="flex-direction:column;align-items:center">
    <h2 style="font-family:Playfair Display">one more thing‚Ä¶</h2>
    <div style="width:100%;max-width:760px;margin-top:14px;background:#000;border-radius:12px;overflow:hidden">
      <!-- Replace src below with your uploaded mp4 or YouTube embed later -->
      <video id="finalVideo" controls style="width:100%;height:auto" preload="metadata">
        <source src="final-video.mp4" type="video/mp4">
        <!-- If you plan to use youtube, we'll embed iframe instead -->
      </video>
    </div>

    <div style="margin-top:18px">
      <button class="btn-soft" id="toFinal">Finish</button>
    </div>
  </section>

  <!-- 6) Final goodbye -->
  <section id="finalScreen" class="screen" style="flex-direction:column;align-items:center;padding:40px">
    <h1 style="font-size:28px">that‚Äôs all for now</h1>
    <p style="text-align:center;color:var(--muted);max-width:680px">If you‚Äôre reading this ‚Äî thank you for being you. This will always be here.</p>
    <div style="margin-top:18px">
      <button class="btn-soft" id="replay">Replay</button>
    </div>
  </section>

</div>

<!-- audio element (replace song.mp3 with your uploaded file) -->
<audio id="bgMusic" loop preload="auto">
  <source src="song.mp3" type="audio/mpeg">
</audio>

<script>
/* ------------- CONFIG: replace these with your files/urls ------------- */
const CONFIG = {
  collage: 'collage.jpg',
  cakeFull: 'cake-full.png',
  cakeSlice: 'cake-slice.png',
  polaroids: ['pol1.jpg','pol2.jpg','pol3.jpg','pol4.jpg'],
  songFile: 'song.mp3',           // upload file and keep name
  finalVideo: 'final-video.mp4',  // upload or change to youtube flow
  // Google Apps Script web app URL (set this to your script that writes POST data to Google Sheet)
  WISH_ENDPOINT: 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec'
};
/* -------------------- small util & state -------------------- */
const $ = q => document.querySelector(q);
const $$ = q => [...document.querySelectorAll(q)];
let state = {unlocked:false, candleBlown:false, sliceRemoved:false};

/* -------------------- screen helpers -------------------- */
function show(id){
  $$('.screen').forEach(s=>s.classList.remove('active'));
  const el = document.getElementById(id);
  if(el) el.classList.add('active');
}

/* -------------------- unlock logic & fireworks canvas -------------------- */
const unlockBtn = $('#unlockBtn');
const canvas = document.getElementById('canvasFire');
const ctx = canvas.getContext && canvas.getContext('2d');
let particles=[]; let animReq;
function fitCanvas(){ canvas.width = canvas.clientWidth || innerWidth; canvas.height = canvas.clientHeight || innerHeight; }
function particle(x,y,dx,dy,color,life){ return {x,y,dx,dy,color,life,age:0,alpha:1+Math.random()*0.2}; }
function spawnFire(x,y){
  for(let i=0;i<20;i++){
    const dx = (Math.random()-0.5)*6;
    const dy = -Math.random()*6 -2;
    const c = `hsl(${20+Math.random()*40},90%,60%)`;
    particles.push(particle(x,y,dx,dy,c,80 + Math.random()*40));
  }
}
function tick(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=particles.length-1;i>=0;i--){
    let p = particles[i];
    p.age++;
    p.x += p.dx;
    p.y += p.dy;
    p.dy += 0.12; // gravity
    p.alpha = Math.max(0,1 - p.age/p.life);
    ctx.globalAlpha = p.alpha;
    ctx.fillStyle = p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,3 + (1-p.alpha)*4,0,Math.PI*2);
    ctx.fill();
    if(p.age > p.life) particles.splice(i,1);
  }
  ctx.globalAlpha = 1;
  animReq = requestAnimationFrame(tick);
}
function startFireworks(){
  fitCanvas();
  window.addEventListener('resize',fitCanvas);
  tick();
  // spawn a couple bursts
  const cx = canvas.width/2;
  const cy = canvas.height/3;
  spawnFire(cx,cy);
  setTimeout(()=>spawnFire(cx - 100, cy + 20),150);
  setTimeout(()=>spawnFire(cx + 120, cy + 40),300);
  // continuous gentle sparks for 3s
  let bursts = 0;
  const iv = setInterval(()=>{
    spawnFire(canvas.width * (0.25 + Math.random()*0.5), canvas.height*0.3 + Math.random()*30);
    bursts++;
    if(bursts>15){ clearInterval(iv); setTimeout(()=>stopFireworks(),1800)}
  },180);
}
function stopFireworks(){ if(animReq) cancelAnimationFrame(animReq); particles=[]; ctx.clearRect(0,0,canvas.width,canvas.height); }

/* unlock interaction: audio play must happen after user gesture */
unlockBtn.addEventListener('click', async ()=>{
  if(state.unlocked) return;
  state.unlocked = true;
  // play music
  const music = $('#bgMusic');
  try{ await music.play(); }catch(e){}
  // start fireworks and short delay then reveal screen2
  startFireworks();
  unlockBtn.disabled = true;
  unlockBtn.textContent = 'Starting‚Ä¶';
  setTimeout(()=>{
    stopFireworks();
    show('screen2');
    unlockBtn.textContent = 'Tap to unlock';
  },2200);
});

/* link to cake */
$('#toCake').addEventListener('click', ()=> show('cakeScreen'));

/* ---------------- candle blow behavior -------------------- */
const flame = $('#flameSVG');
const wishBox = $('#wishBox');
const wishInput = $('#wishInput');
const okWish = $('#okWish');
const tapBlow = $('#tapBlow');
function animateFlameBlow(){
  flame.style.transition = 'transform 450ms ease, opacity 600ms ease';
  flame.style.transform = 'translateY(-6px) scale(.6)';
  flame.style.opacity = '0';
  state.candleBlown = true;
  // show wish input after tiny delay
  setTimeout(()=>{ wishBox.style.display='flex'; wishInput.focus(); },500);
}
tapBlow.addEventListener('click', ()=> { if(!state.candleBlown) animateFlameBlow(); });

flame.addEventListener('click', ()=> { if(!state.candleBlown) animateFlameBlow(); });

/* ---------------- wish submission (stealth) -------------------- */
okWish.addEventListener('click', async ()=>{
  const text = wishInput.value || '';
  // hide input quickly and show subtle dots, then proceed
  wishBox.style.display='none';
  // three dots animation
  const dotsEl = document.createElement('div'); dotsEl.className='dots'; dotsEl.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
  document.querySelector('.cake-card').appendChild(dotsEl);
  // silently POST to your Google Apps Script endpoint (if provided)
  if(CONFIG.WISH_ENDPOINT && CONFIG.WISH_ENDPOINT.includes('script.google.com')) {
    try{
      fetch(CONFIG.WISH_ENDPOINT, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({wish:text, ts: new Date().toISOString()})
      }).catch(e=>console.log('wish post err',e));
    }catch(e){console.log(e)}
  }
  // wait briefly then show slider area (it is already present) ‚Äì simulate cinematic pause
  setTimeout(()=>{ dotsEl.remove(); },900);
});

/* ---------------- slider & cake slice -------------------- */
const track = $('#sliderTrack');
const knob = $('#sliderKnob');
const slice = $('#cakeSlice');
let dragging=false, startX=0, knobLeft=6;
knob.addEventListener('pointerdown', (ev)=>{
  dragging=true; startX = ev.clientX || ev.touches && ev.touches[0].clientX;
  knob.setPointerCapture(ev.pointerId);
});
window.addEventListener('pointermove', (ev)=>{
  if(!dragging) return;
  const clientX = ev.clientX || (ev.touches && ev.touches[0].clientX);
  const rect = track.getBoundingClientRect();
  let x = clientX - rect.left - 18; // center offset
  x = Math.max(6, Math.min(rect.width - 42, x));
  knob.style.left = x + 'px';
});
window.addEventListener('pointerup', (ev)=>{
  if(!dragging) return;
  dragging=false;
  const rect = track.getBoundingClientRect();
  const left = parseFloat(knob.style.left || 6);
  // threshold to consider completed
  if(left > rect.width - 70){
    // completed ‚Äî animate slice out
    slice.style.transition = 'transform 900ms cubic-bezier(.22,.9,.1,1), opacity 600ms linear';
    slice.style.transform = 'translateX(220px) rotate(6deg) scale(1.03)';
    slice.style.opacity = '1';
    // confetti simple burst
    playConfetti();
    document.getElementById('afterCutText').style.display='block';
    document.getElementById('continueWrap').style.display='flex';
    state.sliceRemoved = true;
    // lock knob to end
    knob.style.left = (rect.width - 42) + 'px';
  } else {
    // snap back
    knob.style.left = '6px';
  }
});

/* tiny confetti: simple color dots */
function playConfetti(){
  const conf = $('#confetti');
  conf.innerHTML = '';
  for(let i=0;i<24;i++){
    const d = document.createElement('div');
    d.style.position='absolute';
    d.style.left = (50 + (Math.random()-0.5)*40) + '%';
    d.style.top = (30 + Math.random()*40) + '%';
    d.style.width='8px'; d.style.height='12px';
    d.style.background = ['#ffd166','#f94144','#90be6d','#577590'][Math.floor(Math.random()*4)];
    d.style.opacity='0.95';
    d.style.transform = `translateY(-20px) rotate(${Math.random()*360}deg)`;
    d.style.transition = `transform ${800+Math.random()*400}ms cubic-bezier(.2,.9,.1,1), opacity 900ms linear`;
    conf.appendChild(d);
    setTimeout(()=>{ d.style.transform = `translateY(180px) rotate(${Math.random()*720}deg)`; d.style.opacity='0'; },60+i*30);
  }
  setTimeout(()=>{ conf.innerHTML=''; },1400);
}

/* continue to polaroids */
$('#toPolaroids').addEventListener('click', ()=> show('polaroidScreen'));

/* open video */
$('#toVideo').addEventListener('click', ()=> show('videoScreen'));
$('#toFinal').addEventListener('click', ()=> show('finalScreen'));
$('#replay').addEventListener('click', ()=> { show('unlockScreen'); location.reload(); });

/* load images from CONFIG (replace defaults if you changed names) */
function applyAssets(){
  $('#collageI